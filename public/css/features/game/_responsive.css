/* Responsive Breakpoints - All Media Queries */

/* Mobile - 600px and below */
@media (max-width: 600px) {
    .dictation-container {
        /* Balanced padding for optical vertical centering */
        /* Top: 60px to clear header area */
        /* Bottom: 140px to clear footer + give lift */
        padding: 60px 8px calc(140px + env(safe-area-inset-bottom, 0px)) !important;

        touch-action: pan-y pinch-zoom;
        min-height: 100dvh;

        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
    }

    .dictation-container .writing-card {
        width: 98%;
        padding: 10px;
        margin: 2px 0 30px;
        /* Minimal top margin */
    }

    .dictation-completed-phrases {
        width: 98%;
        margin-bottom: 8px !important;
        padding: 12px 8px;
        /* Increase padding for easier touch scrolling */
        min-height: 48px;
        /* Ensure enough area to grab for scrolling */
        touch-action: pan-y;
        /* Explicitly allow vertical scrolling */
    }

    .card-toolbar {
        gap: 12px;
        /* Tighter spacing on mobile */
        margin: 20px 0 50px;
        /* Increased bottom margin for scroll area */
        touch-action: auto;
        /* Allow touch events to bubble up for scrolling */
    }

    .tool-btn {
        width: 48px;
        height: 48px;
        /* Minimum 48px touch target for accessibility */
    }

    /* Ensure char-box containers don't block scrolling */
    .spelling-chars-container {
        margin: 15px 0 25px;
        /* Add extra bottom margin for scroll area */
    }

    .dictation-header-progress {
        width: 98%;
        margin: 2px auto 2px;
        /* Minimal spacing on mobile */
    }

    .progress-bar-wrapper {
        height: 4px;
    }

    .progress-count {
        font-size: 0.7rem;
        top: 8px;
    }

    /* Prevent huge pinyin on mobile */
    .pinyin-display-large {
        font-size: clamp(1.4rem, 5vw, 1.8rem);
        margin-bottom: 4px;
    }

    /* Allow card to grow slightly if needed for wrapped text */
    .game-stage .writing-card,
    .writing-card {
        height: auto !important;
        min-height: fit-content !important;
        flex-shrink: 0;
        padding-bottom: 25px;
        /* Ensure space for toolbar */
        overflow: visible;
        /* Ensure nothing is clipped */
    }

    /* Fix Pinyin Display spacing */
    .pinyin-display-large {
        margin-top: 10px;
        margin-bottom: 15px;
        padding: 0 5px;
    }
}

/* Small Screens - 380px and below */
@media (max-width: 380px) {
    .char-slot {
        width: min(160px, 48vw);
        height: min(160px, 48vw);
    }

    .dictation-container {
        padding: 0 5px calc(150px + env(safe-area-inset-bottom, 0px)) !important;
        /* Zero top padding for small screens */
    }

    .dictation-container .writing-card {
        padding: 8px;
        margin-top: 1px;
        margin-bottom: 30px;
        /* Ultra-minimal top spacing */
    }

    .dictation-header-progress {
        margin: 1px auto 1px;
        /* Ultra-minimal spacing for small screens */
    }

    .spelling-carousel {
        gap: 10px;
    }

    .card-toolbar {
        gap: 8px;
        margin-bottom: 40px;
        /* Extra bottom margin for small screens */
    }

    .tool-btn {
        width: 48px;
        height: 48px;
        /* Meet 48px minimum touch target for accessibility */
    }

    .indicator-dot {
        width: 10px;
        height: 10px;
        /* Increase from 8px for better visibility and touch */
    }

    .dictation-indicators {
        margin-top: 8px;
        margin-bottom: 20px;
        /* Increased bottom margin for scroll clearance */
    }
}

/* Very Small Devices - 360px and below */
@media (max-width: 360px) {
    .char-slot {
        width: min(140px, 44vw);
        height: min(140px, 44vw);
        /* Smaller for very small screens */
    }

    .writing-card {
        padding: 12px 8px;
        margin: 15px 4px;
    }

    .tool-btn {
        width: 42px;
        height: 42px;
        font-size: 0.95rem;
    }

    .card-toolbar {
        gap: 6px;
        margin-bottom: 35px;
    }

    .indicator-dot {
        width: 9px;
        height: 9px;
    }

    .dictation-indicators {
        margin-top: 6px;
        margin-bottom: 18px;
    }

    .pinyin-display-large {
        font-size: 1.1rem;
    }

    #definition-display {
        font-size: 0.8rem;
    }

    .game-stage {
        padding: 0 4px calc(130px + env(safe-area-inset-bottom, 0px));
        /* Zero top padding for very small screens */
    }
}

/* Wordlist Modal - 500px and below */
@media (max-width: 500px) {
    .wordlist-item {
        grid-template-columns: 36px 1fr;
        gap: 10px;
        padding: 10px 12px;
    }

    .wordlist-pinyin {
        grid-column: 2;
        font-size: 0.85rem;
        margin-top: -4px;
    }

    .wordlist-term {
        font-size: 1.3rem;
    }
}

/* Tablet - 601px to 1024px */
@media (min-width: 601px) and (max-width: 1024px) {
    .char-slot {
        /* Use viewport relative sizing for tablets to prevent overflow on landscape */
        width: min(220px, 35vh);
        height: min(220px, 35vh);
    }

    .writing-card {
        max-width: 700px;
        padding: 30px;
        /* Ensure height adapts to content */
        height: auto;
        min-height: 400px;
    }

    .tool-btn {
        width: 52px;
        height: 52px;
        /* Slightly larger touch targets for tablets */
    }

    .card-toolbar {
        gap: 20px;
    }

    .dictation-container {
        max-width: 800px;
        padding: 4px 16px calc(100px + env(safe-area-inset-bottom, 0px));
        /* Tight top padding for tablets */
    }

    .dictation-container .writing-card {
        margin-top: 6px;
        /* Tight spacing for tablet screens */
    }

    .dictation-header-progress {
        margin: 3px auto 6px;
        /* Tight spacing for tablets */
    }

    .spelling-carousel {
        max-width: 500px;
    }

    .indicator-dot {
        width: 12px;
        height: 12px;
        /* Larger dots for better visibility on tablets */
    }
}

/* Desktop - 1025px and above - Center content like 习字 mode */
@media (min-width: 1025px) {
    .game-stage {
        justify-content: center;
        /* Center vertically on desktop for visual balance */
    }

    .dictation-container {
        justify-content: center !important;
        /* Center vertically on desktop matching 习字 centered appearance */
    }
}

/* Landscape Mode Optimization */
@media (max-width: 900px) and (orientation: landscape) {
    .dictation-container {
        flex-direction: row !important;
        justify-content: center !important;
        align-items: flex-start !important;
        gap: 20px !important;
        padding: 10px !important;
    }

    .dictation-container .writing-card {
        flex: 0 0 auto;
        max-width: 45vh;
        /* Use viewport height for sizing in landscape */
        margin-top: 0;
    }

    .dictation-completed-phrases {
        flex: 1;
        max-width: 40%;
        align-self: center;
        font-size: clamp(1rem, 3vh, 1.8rem) !important;
        /* Scale with viewport height */
    }

    .char-slot {
        width: min(35vh, 200px) !important;
        height: min(35vh, 200px) !important;
    }

    .card-toolbar {
        flex-wrap: nowrap;
        gap: 8px;
    }

    .tool-btn {
        width: 40px !important;
        height: 40px !important;
    }

    .dictation-indicators {
        margin-top: 8px;
        margin-bottom: 10px;
    }

    .hud {
        padding: 4px 10px !important;
    }
}