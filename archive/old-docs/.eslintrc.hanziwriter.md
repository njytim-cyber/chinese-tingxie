# HanziWriter Usage Guidelines

## CRITICAL: Preventing the "Invisible Strokes After Reveal" Bug

### The Problem
Calling `writer.hideCharacter()` without the `{duration}` parameter in quiz mode causes a visibility state bug where:
- User strokes become invisible after using the reveal button
- Stroke sounds still play (confusing the user)
- The character appears "broken" until the page is refreshed

### The Solution: Use Helper Functions

**ALWAYS** use the helper functions from `src/utils/hanziWriterHelpers.ts`:

```typescript
import { revealCharacterSafely } from './utils/hanziWriterHelpers';

// ✅ CORRECT - Use the helper
revealCharacterSafely(writer, {
    showDuration: 400,
    hideDuration: 200,
    displayTime: 1000
});

// ❌ WRONG - Never call these directly in quiz mode
writer.showCharacter();
writer.hideCharacter();
writer.hideCharacter({ duration: 200 }); // Even this is risky - use the helper!
```

### Why This Matters

1. **Centralized Fix**: The bug fix lives in one place, making it easier to maintain
2. **Type Safety**: Helper functions enforce correct parameter usage
3. **No Regression**: Can't accidentally break this by calling methods directly
4. **Clear Intent**: `revealCharacterSafely()` makes the intention obvious

### For Code Reviewers

When reviewing PRs that touch HanziWriter code:

- [ ] Verify no direct calls to `writer.showCharacter()` or `writer.hideCharacter()` in quiz mode
- [ ] Check that `revealCharacterSafely()` is imported and used instead
- [ ] If new reveal functionality is added, ensure it uses the helper functions

### For New Features

If you're adding new features that need to show/hide characters:

1. Import the helper: `import { revealCharacterSafely } from './utils/hanziWriterHelpers';`
2. Use it: `revealCharacterSafely(writer, options);`
3. Don't reinvent the wheel - the helper handles all edge cases

### Technical Details

The helper function (`revealCharacterSafely`):
1. Resets character state with `hideCharacter({ duration: 0 })`
2. Shows character with animation using `showCharacter({ duration })`
3. Waits for display time
4. Hides character properly with `hideCharacter({ duration })`

Missing the `{duration}` parameter in step 4 causes the bug.

## Related Files

- **Utility**: `src/utils/hanziWriterHelpers.ts` - The helper functions
- **Usage**: `src/input.ts` - Tingxie mode reveal
- **Usage**: `src/dictation.ts` - Dictation mode reveal
- **This Doc**: `.eslintrc.hanziwriter.md` - Guidelines (you are here)
